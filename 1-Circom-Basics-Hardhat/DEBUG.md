# üîç DEBUG.md ‚Äî Summary of major errors that occurred during Hardhat integration

This document summarizes **major errors and resolution processes** that occurred during the process of integrating Circom circuit-based ZK-SNARK proofs with Solidity via Hardhat.

---

## üß® List of major errors and resolution methods

### 1. `verifier.deployed is not a function`

**Error message:**

```
TypeError: verifier.deployed is not a function
```

**Cause:**

- `verifier.sol` generated by Circom is a utility contract without a constructor, and is not compatible with Hardhat tracking functions such as `deployed()`.

**Solution:**

````js
// This code should be removed
// await verifier.deployed(); ```

---

### 2. `array is wrong length`

**Error message:**

````

Error: array is wrong length

````

**Cause:**

- Occurs when the exact array structure required by the Solidity `verifyProof()` function does not match the passed JS array.
- In particular, the left-right inversion of `pi_b`, the number of `publicSignals`, and the order are important.

**Solution:**

```js
// Left-right inversion is required (snarkjs has a different coordinate order)
b: [
[BigInt(pi_b[0][1]), BigInt(pi_b[0][0])],
[BigInt(pi_b[1][1]), BigInt(pi_b[1][0])],
]; ```

---

### 3. `expected true but got false` (AssertionError)

**Error message:**

````

AssertionError: expected false to be true

````

**Cause:**

- Occurs when the proof is invalid
- Usually due to input error, witness generation failure, or mismatch between public input and expected input of verifier

**Solution:**

- Recompile Circom circuit and regenerate `.zkey`, `.ptau`, `verifier.sol`, and retry proof

---

### 4. public.json structure mismatch

**Error message:** `invalid array value`, or array length mismatch

**Cause:**

- Solidity `verifyProof()` takes exactly 4 `uint` public inputs, but `[isValid, input1, input2, input3]` in `public.json` are all should be included

**Solution:**

- Trying to remove `isValid` like `publicSignals = rawPublic.slice(1)` in test code fails
- **Conclusion:** `public.json` needs to include all `signal output` and `input` of Circom circuit ‚Üí `4`

---

## ‚úÖ Summary of the final working structure

```js
proof = {
a: bigIntify(pi_a.slice(0, 2)),
b: [
[BigInt(pi_b[0][1]), BigInt(pi_b[0][0])],
[BigInt(pi_b[1][1]), BigInt(pi_b[1][0])],
],
c: bigIntify(pi_c.slice(0, 2)),
};

publicSignals = bigIntify(rawPublic); // Keep all 4
````

---

## üß† Practical Tips

- **If Hardhat test fails**, check in the following order:

1. Check if `verifyProof()` signature in Verifier.sol matches input value
2. Check number, order, and type of values ‚Äã‚Äãin proof/public.json
3. Check if .zkey / verifier.sol / input.json is regenerated
